<!DOCTYPE html>
<html>
<head>
  <title>Ae-News</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!--<div class="pop-up">
    <p>Ae-News</p>
    <h2>Hello!</h2>
    <p>The website is under construction. Please wait until we get the API.</p>
  </div>-->
<div class="container">
  <h1>Ae-News</h1>
  <br>
  <form id="search-form">
    <input type="text" id="search-input" placeholder="Search..." required>
    <button type="submit" class="submit-button">Search</button>
  </form>
  <div id="search-results"></div>
</div>
<footer>
  <p class="p-footer">Ae-News</p>
  <a href="https://github.com/butwm" class="butwm-footer">Butwm</a>
</footer>
  <script>
    const apiKey = 'vS3UM5KRqj1bqyeltettMqXAiHFX5IRzpKFdjPY1fV4';
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');

    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diff = Math.round((now - date) / 1000);

      if (diff < 3600) {
        const minutes = Math.floor(diff / 60);
        const hours = Math.floor(minutes / 60);
        const remainingMinutes = minutes % 60;
        return `${hours} hours and ${remainingMinutes} minutes ago`;
      } else {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('en-US', options);
      }
    }

    searchForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const query = searchInput.value;
      const url = `https://api.newscatcherapi.com/v2/search?q=${query}&lang=en`;

      try {
        const response = await fetch(url, { headers: { 'x-api-key': apiKey } });

        if (response.ok) {
          const data = await response.json();
          let resultsHtml = '';

          for (const article of data.articles) {
            const readingTime = Math.round(article.words / 210) || 1;
            const formattedDate = formatDate(article.published_date);

            resultsHtml += `
              <div class="article">
                <h2><a href="${article.link}" target="_blank">${article.title}</a></h2>
                <p>${article.summary}</p>
                <p>Reading time: ${readingTime} minute${readingTime !== 1 ? 's' : ''}</p>
                <p>Published: ${formattedDate}</p>
                <a href="${article.link}" target="_blank">${article.author}</a>
              </div>
            `;
          }

          searchResults.innerHTML = resultsHtml;
        } else {
          searchResults.innerHTML = `An error occurred: ${response.status} - ${response.statusText}`;
        }
      } catch (error) {
        searchResults.innerHTML = `An error occurred: ${error.message}`;
      }
    });
  </script>
</body>
</html>
